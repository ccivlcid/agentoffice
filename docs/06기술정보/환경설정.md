# HAIFeR Agent 환경 설정 가이드

---

## 1. 필수 환경변수

| 변수 | 필수 | 기본값 | 설명 |
|------|------|--------|------|
| `OAUTH_ENCRYPTION_SECRET` | **필수** | - | OAuth 토큰 암호화 키 |
| `INBOX_WEBHOOK_SECRET` | `/api/inbox` 사용 시 필수 | - | 태스크 웹훅 공유 시크릿 |
| `PORT` | 선택 | 8790 | 백엔드 서버 포트 |
| `HOST` | 선택 | 127.0.0.1 | 바인딩 호스트 |
| `DB_PATH` | 선택 | `hyperclaw.sqlite` | SQLite DB 파일 경로 |
| `API_AUTH_TOKEN` | 권장 | - | 원격 API/WebSocket 접근 토큰 |
| `OPENCLAW_CONFIG` | 권장 | - | OpenClaw 메신저 게이트웨이 설정 경로 |

---

## 2. SQLite 튜닝 변수

| 변수 | 기본값 | 범위 | 설명 |
|------|--------|------|------|
| `SQLITE_BUSY_TIMEOUT_MS` | 5000 | - | DB 잠금 대기 시간(ms) |
| `SQLITE_BUSY_RETRY_MAX_ATTEMPTS` | 4 | 최대 20 | 재시도 횟수 |
| `SQLITE_BUSY_RETRY_BASE_DELAY_MS` | 40 | - | 초기 재시도 대기(ms) |
| `SQLITE_BUSY_RETRY_MAX_DELAY_MS` | 400 | - | 최대 재시도 대기(ms) |
| `SQLITE_BUSY_RETRY_JITTER_MS` | 20 | - | 랜덤 지터(ms) |

---

## 3. 리뷰/워크플로우 변수

| 변수 | 기본값 | 설명 |
|------|--------|------|
| `REVIEW_MAX_ROUNDS` | 3 | 태스크당 최대 리뷰 라운드 |
| `IN_PROGRESS_ORPHAN_GRACE_MS` | 600000 (10분) | 고아 태스크 유예 기간 |
| `IN_PROGRESS_ORPHAN_SWEEP_MS` | 30000 (30초) | 고아 태스크 스캔 주기 |
| `SUBTASK_DELEGATION_SWEEP_MS` | 15000 (15초) | 서브태스크 위임 스캔 주기 |
| `MEETING_TRANSCRIPT_MAX_TURNS` | 20 | 회의 프롬프트 최대 턴 수 |

---

## 4. 실행 스크립트

### 개발

```bash
pnpm dev:local       # 프론트 127.0.0.1:8800 + 백엔드 127.0.0.1:8790 (권장)
pnpm dev             # 네트워크 접근 가능 (0.0.0.0)
pnpm dev:tailscale   # Tailscale 네트워크 접근
```

### 프로덕션

```bash
pnpm build           # TypeScript + Vite 빌드 (dist/)
pnpm start           # 컴파일된 서버 실행, 빌드된 프론트 제공
pnpm preview         # 프로덕션 빌드 미리보기
```

### 테스트

```bash
pnpm test            # 전체 테스트 (web + api)
pnpm test:web        # 프론트엔드 단위 테스트
pnpm test:api        # 백엔드 단위 테스트 (29개 테스트)
pnpm test:e2e        # E2E 테스트 (Playwright)
pnpm test:ci         # CI 파이프라인용 (커버리지 포함)
```

### QA/유지보수

```bash
pnpm check:lines     # 300줄 제한 검증
pnpm arch:map        # 아키텍처 리포트 생성
pnpm preflight:public # 릴리즈 전 보안 스캔
pnpm test:comm:suite  # 통합 통신 QA (LLM/OAuth/API)
pnpm test:qa:project-path # 경로 헬퍼 스모크 테스트
```

---

## 5. 빌드 설정

### Vite (`vite.config.ts`)
- React + Tailwind 플러그인
- 개발 서버 프록시 → `http://127.0.0.1:8790`
- WebSocket 프록시 지원
- 매뉴얼 청크 분할: React, Router, Pixi.js, PPTX
- 청크 사이즈 경고: 550KB

### TypeScript
- **프론트**: `tsconfig.app.json` — ES2022 타겟, ESNext 모듈, Strict
- **백엔드**: `tsconfig.node.json` — Node.js 환경
- **JSX**: react-jsx

---

## 6. 배포 모드

| 모드 | 바인딩 | 용도 |
|------|--------|------|
| `dev:local` | 127.0.0.1 | 로컬 개발 (기본) |
| `dev` / `start:tailscale` | 0.0.0.0 | 네트워크 접근 (팀/서버) |
| `start` | HOST 환경변수 | 프로덕션 |
