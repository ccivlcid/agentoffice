# 오피스 뷰 카드/그리드 개편 설계서

> **문서화 우선** — 설계·구현에 앞서 요구사항·구조·마이그레이션을 문서로 정리한다.  
> 선택 방향: **C. 카드/그리드** (픽셀 제거, React + Tailwind, 유저 친화·에이전트 업무 배정 편의)

---

## 1. 목표 및 요구사항

### 1.1 목표

| 항목 | 내용 |
|------|------|
| **비주얼** | 픽셀 캔버스 제거 → 카드/그리드 기반 React UI |
| **유저 친화** | 한눈에 부서·에이전트 파악, 클릭/탭으로 직관적 동작 |
| **업무 배정** | 각 에이전트에게 일을 시키고, 채팅·태스크 연결을 편하게 |

### 1.2 비목표 (이번 개편에서 다루지 않음)

- Pixi/캔버스 유지 옵션 (벡터 미니멀 등) — 별도 브랜치나 설정이면 가능
- 3D·아이소메트릭·블루프린트 — 본 설계 범위 밖

---

## 2. AS-IS 요약

### 2.1 현재 구조

- **OfficeView.tsx**: Pixi 캔버스 컨테이너 + 모바일 가상 패드 + CliUsagePanel
- **useOfficePixi**: 캔버스 초기화, 씬 구축(buildOfficeScene), 애니메이션 틱
- **office-view/** 하위: officeViewScene*.ts, officeViewPalette, officeViewAnimTick, officeViewDeliveryEffects, useOfficeInput 등 (Pixi 의존 다수)
- **상호작용**: 캔버스 위 클릭 → 부서/에이전트 선택 → `onSelectAgent`, `onSelectDepartment` 콜백

### 2.2 App에서의 사용

- `view === "office"` 일 때 `<OfficeView ... />` 렌더
- **주요 Props**: `departments`, `agents`, `tasks`, `subAgents`, `meetingPresence`, `unreadAgentIds`, `onSelectAgent`, `onSelectDepartment` 등
- **onSelectAgent(agent)** → `setSelectedAgent(a)` (에이전트 상세/모달 연동)
- **onSelectDepartment(dept)** → 해당 부서 팀장(team_leader) 찾아서 `handleOpenChat(leader)` 호출

### 2.3 유지해야 할 동작

- 에이전트 클릭 시 기존과 동일하게 **에이전트 선택(상세)** 연결
- 부서(또는 부서 카드) 클릭 시 **팀장과 채팅** 연결 가능
- **CliUsagePanel**은 그대로 두거나, 동일 데이터로 카드 뷰 하단에 유지
- meetingPresence, unreadAgentIds 등 **기존 데이터**는 App이 그대로 전달하므로 Props 호환 유지

---

## 3. TO-BE: 화면 구성

### 3.1 전체 레이아웃

```
┌─────────────────────────────────────────────────────────┐
│  [상단] 제목 / 설명 (선택) "오피스" 또는 "팀·에이전트"     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  [부서 카드 그리드]                                       │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │ 부서 A      │ │ 부서 B      │ │ 휴게실      │  ...   │
│  │ ┌──┐ ┌──┐  │ │ ┌──┐       │ │ (쉬는 중)   │        │
│  │ │에│ │에│  │ │ │에│       │ │             │        │
│  │ └──┘ └──┘  │ │ └──┘       │ │             │        │
│  │ [채팅]     │ │ [채팅]     │ │             │        │
│  └─────────────┘ └─────────────┘ └─────────────┘        │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  [하단] CLI 사용량 패널 (기존 CliUsagePanel, 접이식 유지)  │
└─────────────────────────────────────────────────────────┘
```

### 3.2 부서 카드 (DeptCard)

| 요소 | 설명 |
|------|------|
| **헤더** | 부서 이름(name / name_ko), (선택) 에이전트 수·진행 중 태스크 수 |
| **에이전트 목록** | 아바타 + 이름(또는 name_ko), 역할(팀장/시니어 등), 상태(작업 중/대기 등) |
| **액션** | "팀장과 채팅" 버튼 또는 카드 클릭 → onSelectDepartment(dept) |
| **에이전트 클릭** | 해당 에이전트 선택 → onSelectAgent(agent) (상세·채팅·업무 배정으로 이어짐) |

### 3.3 에이전트 행(AgentRow) 또는 미니 카드

| 요소 | 설명 |
|------|------|
| **아바타** | 기존 AgentAvatar 또는 Icon 재사용 (avatar_emoji → AVATAR_ICONS) |
| **이름** | agent.name / name_ko (설정에 따라) |
| **역할** | team_leader / senior / junior 등 뱃지 또는 텍스트 |
| **상태** | 작업 중 태스크 있음 / 대기 등 (tasks 기준 표시, 선택) |
| **빨간 점 등** | unreadAgentIds.has(agent.id) 시 읽지 않음 표시 |
| **클릭** | onSelectAgent(agent) |

### 3.4 휴게실(Break Room) — 팀 미배정 에이전트 공간

- 부서가 아닌 **휴게실** 카드 1개. **팀 배정이 안 된 에이전트**를 모아서 표시하는 공간으로 활용.
- **미배정 조건**: `department_id`가 비어 있거나, `departments` 목록에 없는 에이전트. (비활성 제외)
- 휴게실 카드에도 **AgentRow**로 에이전트 목록 표시, 클릭 시 `onSelectAgent(agent)` 동일 적용. "팀장과 채팅" 버튼은 없음(부서가 없으므로).
- 빈 경우: "팀 배정이 안 된 에이전트가 없습니다." 안내 문구 표시.
- **에이전트 고용**: `OfficeViewProps.onHireAgent`를 전달하면 휴게실 카드 하단에 "에이전트 고용" 버튼이 노출된다. 클릭 시 부모에서 모달/폼·API 등으로 신규 에이전트 추가 처리(신규 에이전트는 미배정으로 휴게실에 표시).

---

## 4. 컴포넌트 구조 (제안)

```
OfficeView (기존 Props 유지)
├── 상단: 제목/설명 (선택)
├── OfficeGrid (부서 + 휴게실 카드 그리드)
│   ├── DeptCard (부서별)
│   │   ├── DeptCardHeader (이름, 인원/태스크 수)
│   │   ├── AgentList (해당 부서 agents)
│   │   │   └── AgentRow (아바타, 이름, 역할, 상태, 클릭 → onSelectAgent)
│   │   └── DeptCardActions ("팀장과 채팅" → onSelectDepartment)
│   └── BreakRoomCard (휴게실 = 팀 미배정 에이전트 목록, AgentRow 동일)
└── CliUsagePanel (기존 컴포넌트 재사용, 동일 props)
```

- **OfficeView**: 기존 `OfficeViewProps` 그대로 받고, 내부만 Pixi 대신 위 트리로 렌더.
- **DeptCard / AgentRow / OfficeGrid**: 신규 컴포넌트, `office-view/` 또는 `office-view/card/` 하위에 두는 것 권장.

---

## 5. 데이터·Props

### 5.1 유지하는 Props (App 호환)

- `departments`, `agents`, `tasks`, `subAgents`
- `meetingPresence`, `activeMeetingTaskId`, `unreadAgentIds`
- `onSelectAgent`, `onSelectDepartment`
- (필요 시) `customDeptThemes`, `themeHighlightTargetId` — 카드 테마 색 등으로 활용 가능
- `crossDeptDeliveries`, `ceoOfficeCalls`, `onOpenActiveMeetingMinutes` 등 — 1차에서 사용하지 않더라도 **Props는 유지**해 두고, 카드 뷰에서는 무시하거나 나중에 "알림 뱃지" 등으로 연결 가능

### 5.2 제거·축소 (카드 뷰에서)

- Pixi 전용: `themeHighlightTargetId`로 캔버스 하이라이트 — 카드에서는 카드 테두리 등으로 대체 가능
- **캔버스/가상 패드**: 제거 (스크롤만으로 전체 그리드 탐색)

### 5.3 파생 데이터

- **부서별 에이전트**: `agents.filter(a => a.department_id === dept.id)` (비활성 제외는 기존과 동일)
- **에이전트별 진행 중 태스크 수**: `tasks.filter(t => t.assignee_id === agent.id && t.status !== 'done' && t.status !== 'cancelled').length`
- **팀장**: `agents.find(a => a.department_id === dept.id && a.role === 'team_leader')`

---

## 6. 사용자 시나리오 (유저 친화·업무 배정)

| 시나리오 | 동작 |
|----------|------|
| **에이전트에게 일 맡기기** | 해당 부서 카드 → 에이전트 클릭 → onSelectAgent → (기존) 에이전트 상세/모달에서 태스크 배정 또는 채팅으로 지시 |
| **팀장과 빠르게 대화** | 부서 카드에서 "팀장과 채팅" 또는 부서 클릭 → onSelectDepartment → (기존) 팀장 채팅 열림 |
| **누가 바쁜지 보기** | 카드 내에서 에이전트별 상태(작업 중/대기) 표시로 한눈에 파악 |
| **읽지 않은 메시지** | unreadAgentIds로 에이전트 행에 빨간 점 등 표시 → 클릭해 상세/채팅 |

---

## 7. 반응형·접근성

- **그리드**: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3` 등으로 좁은 화면에서는 1열, 넓은 화면에서 2~3열.
- **카드**: 터치/클릭 영역 충분히 확보, 포커스 링, 버튼/카드에 `aria-label` 등 (기존 디자인 시스템·접근성 가이드 준수).
- **CliUsagePanel**: 기존처럼 접이식 유지.

---

## 8. 마이그레이션 순서 (문서화 후 구현)

| 단계 | 내용 | 산출물 |
|------|------|--------|
| **0** | **설계 문서화** | ✅ 본 문서 (오피스뷰-카드그리드-설계.md) |
| 1 | OfficeView 카드 뷰 전환 | ✅ Pixi 제거, `OfficeView.tsx`에서 상단 헤더 + OfficeGrid + CliUsagePanel만 렌더 |
| 2 | OfficeGrid + DeptCard + AgentRow 구현 | ✅ `office-view/card/OfficeGrid.tsx`, `DeptCard.tsx`, `AgentRow.tsx` |
| 3 | CliUsagePanel 연동 | ✅ 기존 컴포넌트 그대로 하단 배치, CLI_DISPLAY·getCliStatus/Usage 유지 |
| 4 | 상단 제목/설명 | ✅ LOCALE_TEXT.officeCardTitle, officeCardSubtitle |
| 5 | 레거시 Pixi 경로 제거 또는 설정으로 비활성화 | ⏳ 카드 뷰가 기본으로 적용됨. Pixi 관련 파일(useOfficePixi, officeViewScene* 등)은 미삭제 상태 — 필요 시 추후 제거 |
| 6 | 휴게실 = 미배정 에이전트 공간 | ✅ BreakRoomCard: department_id 없거나 부서 목록에 없는 에이전트 표시, AgentRow·onSelectAgent 동일 |
| 7 | 테스트·접근성·반응형 점검 | ⏳ 그리드 반응형(sm:2열 lg:3열), 포커스 링·aria-label 적용됨. 수동 테스트 권장 |

---

## 9. 파일 배치 (제안)

| 구분 | 경로 | 비고 |
|------|------|------|
| 진입점 | `src/components/OfficeView.tsx` | Props 유지, 카드 뷰 렌더로 전환 또는 분기 |
| 카드 뷰 | `src/components/office-view/OfficeGrid.tsx` | 그리드 레이아웃 |
| | `src/components/office-view/DeptCard.tsx` | 부서 카드 |
| | `src/components/office-view/AgentRow.tsx` | 에이전트 한 행 (아바타, 이름, 역할, 상태, 클릭) |
| 기존 유지 | `src/components/office-view/CliUsagePanel.tsx` | 그대로 사용 |
| 기존 유지 | `src/components/office-view/officeViewPalette.ts` | LOCALE_TEXT 등 카드 뷰에서도 사용 가능 |
| 레거시 (삭제 예정 또는 비활성) | `useOfficePixi`, `officeViewScene*.ts`, `officeViewAnimTick.ts` 등 | 카드 뷰 확정 후 제거 또는 별도 디렉터리로 이동 |

---

## 10. 요약

- **문서화 우선**: 본 설계서로 목표·화면·컴포넌트·데이터·마이그레이션 순서를 고정한다.
- **구현 순서**: 0(문서) → 1(분기) → 2(그리드·카드·에이전트 행) → 3(CliUsagePanel) → 4(상단) → 5(레거시 정리) → 6(테스트).
- **유저 친화·업무 배정**: 에이전트 클릭 → 기존 onSelectAgent(상세/채팅/업무), 부서 클릭 → 팀장 채팅; 카드 내 상태·읽지 않음 표시로 "일 시키고 편하게" 지원.

이 문서가 확정된 뒤, 단계 1부터 구현을 진행하면 된다.
